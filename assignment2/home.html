<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="https://code.highcharts.com/highcharts.js"></script> -->
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/stock/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>    
    <link rel="shortcut icon" href="#">
    <title>Stock Search</title>
</head>
<style>
    body{
        padding: 0;
        margin:0
    }
    .tab{
        width:100px;
        height:40px;
        float:left;
        text-align: center;

    }
    #summaryTab{
        width:150px;
    }
    div.selected{
        background-color: grey;
    }
    #header{
        display: flex;
    }
    .title{
        margin-top:10px;
    }
    .line{
        width:500px;
        height:1px;
        background-color:lightgray;
        margin-left:100px
    }
    .arrow{
        width:10px;
        height:10px;
    }
    .index{
        width:25px;
        height:30px;
        text-align: center;
        padding-top:10px;
    }
    .newsCol{
        width:700px;
        background-color: whitesmoke;
        height:100px;
        margin-top:20px;
        display:flex;
    }

    .newsImg{
        width:80px;
        height:80px;
        float:left;
        margin-left:10px;
        margin-top:10px;
        margin-right:10px;
    }

    .newsContent{
        float:left;
        height:100px;
        width:590px;
    }

    h4{
        margin-top:5px;
        margin-bottom:2px;
    }
    .newsP{
        margin-top:3px;
        margin-bottom: 3px;
        font-size:15px;
    }
    .newsA{
        margin-top:3px;
        font-size:6;
    }


</style>
<body>
    <div id="searchBox" style="height: 300px;width: 1000px;background-image: url('static/img/back.svg');margin-top:0px;padding-top: 0;">
        <h1 style="text-align: center;">Stock Search</h1>
        <form id="searchForm" style="margin-left:200px" >
            <input type="button" value="" id="searchButton"  style="background-image: url('static/img/search-solid.svg');background-size: cover;width:40px;height:40px;" />
            <input type="text" name="symbol" id="content" placeholder="Enter Stock Symbol" style="width: 500px;height:40px;margin: 0px;" required> 
            <input type="button" id="clearButton" style="background-image: url('static/img/times-solid.svg');background-size: cover;width:40px;height: 40px;" />
        </form>
    </div>

    <div id="result" style="width:700px;margin-left:200px;">
        <div id="header" style="width:100%;height:40px;background-color:whitesmoke;display:none">
            <div id="companyTab" class="tab selected">
                <p class="title">Company</p>
            </div>
            <div id = "summaryTab" class="tab">
                <p class="title">Stock Summary</p>
            </div>
            <div id = "chartsTab" class="tab">
                <p class="title">Charts</p>
            </div>
            <div id = "newsTab" class="tab">
                <p class="title">Latest News</p>
            </div>
        </div>

        <div id="containerCompany" style="width:700px;height:400px;margin-top:20px;display:none;">
            <img id="logo" style="width:70px;height:70px;margin-left:300px;margin-bottom:10px">
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Company Name:</div><div id="CompanyName" style="float:left;width:350px;text-align: left;"></div></div>
            <div class ="line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Stock Ticker Symbol:</div><div id="StockTicker" style="float:left;width:350px;text-align: left;"></div></div>
            <div class ="line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Stock Exchange Code:</div><div id="ExchangeCode" style="float:left;width:350px;text-align: left;"></div></div>
            <div class ="line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Company Start Date:</div><div id="StartDate" style="float:left;width:350px;text-align: left;"></div></div>
            <div class ="line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Category:</div><div id="Category" style="float:left;width:350px;text-align: left;"></div></div>
            <div class ="line"></div>
        </div>

        <div id="containerSummary" style="width:700px;height:400px;margin-top:20px;display:none;">
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Stock Ticker Symbol:</div><div id="Ticker" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Trading Day:</div><div id="TradingDay" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Previous Closing Price:</div><div id="PreviousClosing" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Opening Price:</div><div id="Opening" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">High Price:</div><div id="High" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Low Price:</div><div id="Low" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Change:</div><div id="Change" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <div style="display:flex"><div style="float:left;width: 350px;text-align: right;">Change Percent:</div><div id="ChangePercent" style="float:left;width:350px;text-align: left;"></div></div>
            <div class = "line"></div>
            <br>
            <div style="display:flex;width:500px;margin-left: 230px;" class="index">
                <div style="float:left;color:red;width:50px;height: 20px;" >Strong Sell</div>
                <div style="float:left;background-color: red;" class="index" id="StrongSell"></div>
                <div style="float:left;background-color: brown;" class="index" id="Sell"></div>
                <div style="float:left;background-color:darkgreen;" class="index" id="Hold"></div>
                <div style="float:left;background-color:green;" class="index" id="Buy"></div>
                <div style="float:left;background-color: lightgreen;" class="index" id="StrongBuy"></div>
                <div style="color:green;width:50px;height: 20px;" >Strong Buy</div>
            </div>
        </div>
        <div id="chartContainer" style="width:700px;height:700px;display:none">

        </div>

        <div id="news" style="width:700px;display:none">
            <div class = "newsCol">
                <img class = "newsImg" id = "newsImg1">
                <div class = "newsContent">
                    <h4 id = "news1h"></h4>
                    <p id = "news1p" class = "newsP"></p>
                    <a id = "news1a" href = "" class = "newsA"></a>
                </div>
            </div>
            <div class = "newsCol">
                <img class = "newsImg" id = "newsImg2">
                <div class = "newsContent">
                    <h4 id = "news2h"></h4>
                    <p id = "news2p" class = "newsP"></p>
                    <a id = "news2a" href = "" class = "newsA"></a>
                </div>
            </div>
            <div class = "newsCol">
                <img class = "newsImg" id = "newsImg3">
                <div class = "newsContent">
                    <h4 id = "news3h"></h4>
                    <p id = "news3p" class = "newsP"></p>
                    <a id = "news3a" href = "" class = "newsA"></a>
                </div>
            </div>
            <div class = "newsCol">
                <img class = "newsImg" id = "newsImg4">
                <div class = "newsContent">
                    <h4 id = "news4h"></h4>
                    <p id = "news4p" class = "newsP"></p>
                    <a id = "news4a" href = "" class = "newsA"></a>
                </div>
            </div>
            <div class = "newsCol">
                <img class = "newsImg" id = "newsImg5">
                <div class = "newsContent">
                    <h4 id = "news5h"></h4>
                    <p id = "news5p" class = "newsP"></p>
                    <a id = "news5a" href = "" class = "newsA"></a>
                </div>
            </div>
        </div>
    </div>

    <div id="error" style="width:550px;height:35px;background-color:lightgray;margin-left: 20%;margin-top:80px;border-radius:8px;display: none;">
        <p style="text-align: center;padding-top:10px;">Error: No record has been found, please enter a valid symbol </p>
    </div>

    <script>

        let currentTab = document.getElementById('companyTab')
        let currentContent = document.getElementById("containerCompany")
        //clear results
        document.getElementById('clearButton').onclick = function(){
            document.getElementById('content').value = ""
            document.getElementById("error").style.display = "none"
            document.getElementById("result").style.display = "none"
            document.getElementById("companyTab").classList.add("selected")
            currentTab.classList.remove("selected")
            currentTab = document.getElementById("companyTab")
        }
        
        document.getElementById("companyTab").addEventListener("click",function(){
            document.getElementById("companyTab").classList.add("selected")
            currentTab.classList.remove("selected")
            currentTab = document.getElementById("companyTab")
            document.getElementById("containerSummary").style.display = "none"
            document.getElementById("chartContainer").style.display = "none"
            document.getElementById("news").style.display = "none"
            document.getElementById("containerCompany").style.display = "block"
        })

        document.getElementById("summaryTab").addEventListener("click",function(){
            document.getElementById("summaryTab").classList.add("selected")
            currentTab.classList.remove("selected")
            currentTab = document.getElementById("summaryTab")
            document.getElementById("containerCompany").style.display = "none"
            document.getElementById("chartContainer").style.display = "none"
            document.getElementById("news").style.display = "none"
            document.getElementById("containerSummary").style.display = "block"
        })

        document.getElementById("chartsTab").addEventListener("click",function(){
            document.getElementById("chartsTab").classList.add("selected")
            currentTab.classList.remove("selected")
            currentTab = document.getElementById("chartsTab")
            document.getElementById("containerCompany").style.display = "none"
            document.getElementById("containerSummary").style.display = "none"
            document.getElementById("news").style.display = "none"
            document.getElementById("chartContainer").style.display = "block"
        })

        document.getElementById("newsTab").addEventListener("click",function(){
            document.getElementById("newsTab").classList.add("selected")
            currentTab.classList.remove("selected")
            currentTab = document.getElementById("newsTab")
            document.getElementById("containerCompany").style.display = "none"
            document.getElementById("chartContainer").style.display = "none"
            document.getElementById("containerSummary").style.display = "none"
            document.getElementById("news").style.display = "block"
        })

    
        document.getElementById('searchButton').onclick = async function(e){
            // e.preventDefault()
            document.getElementById("error").style.display = "none"
            document.getElementById("result").style.display = "none"
            currentTab.classList.remove("selected")
            document.getElementById("companyTab").classList.add("selected")
            currentTab = document.getElementById("companyTab")
            symbol = document.getElementById('content').value
            link = "https://cleonardolouassignment2-564738.wl.r.appspot.com/GetFormData/" + symbol
            fetch(link).then(res =>{
                return res.json()
            }).then(data=>{
                if(data.found == 0){
                    document.getElementById("error").style.display="block"
                }
                else{
                    generateHTML(data)
                }
            })
        }

        function generateHTML(info){
            let currentTab = document.getElementById('companyTab')
            let currentContent = document.getElementById("containerCompany")
            //company page
            document.getElementById("logo").src = info.logo
            document.getElementById("CompanyName").innerHTML = info.name
            document.getElementById("StockTicker").innerHTML = info.ticker
            document.getElementById("ExchangeCode").innerHTML = info.exchange
            document.getElementById("StartDate").innerHTML = info.ipo
            document.getElementById("Category").innerHTML = info.finnhubIndustry
            // show result and company page
            document.getElementById("result").style.display = "block"
            document.getElementById("containerCompany").style.display = "block"
            document.getElementById("header").style.display="block"


            //summary page
            document.getElementById("Ticker").innerHTML = info.ticker
            let Day = new Date(0)
            Day.setUTCSeconds(info.t)
            document.getElementById("TradingDay").innerHTML = Day.toDateString()
            document.getElementById("PreviousClosing").innerHTML = info.pc
            document.getElementById("Opening").innerHTML = info.o
            document.getElementById("High").innerHTML = info.h
            document.getElementById("Low").innerHTML = info.l
            document.getElementById("Change").innerHTML = info.d
            document.getElementById("ChangePercent").innerHTML = info.dp
            let img = document.createElement("img"); 
            let img2 = document.createElement("img"); 
            if(info.d >=0){
                img.src = "static/img/GreenArrowUp.png"
                img2.src = "static/img/GreenArrowUp.png"
            }
            else{
                img.src = "static/img/RedArrowDown.png"
                img2.src = "static/img/RedArrowDown.png"
            }
            img.classList.add("arrow")
            img2.classList.add("arrow")
            document.getElementById("Change").appendChild(img)
            document.getElementById("ChangePercent").appendChild(img2)
            document.getElementById("StrongBuy").innerHTML = info.strongBuy
            document.getElementById("Buy").innerHTML = info.buy
            document.getElementById("Hold").innerHTML = info.hold
            document.getElementById("Sell").innerHTML = info.sell
            document.getElementById("StrongSell").innerHTML = info.strongSell


            //charts
            const currentDate = new Date().toDateString();
            let DataArray1 = []
            let DataArray2 = []
            for(let i = 0;i< info.results.length;i++){
                let temp = []
                let d = new Date(info.results[i].t)
                DataArray1.push({
                    x:d.getTime(),
                    y:info.results[i].c
                })

                DataArray2.push({
                    x:d.getTime(),
                    y:info.results[i].v/1000000
                })
            }
            let chart
            Highcharts.stockChart('chartContainer', {

title: {
    text: 'Stock Price ' + info.ticker + " " + currentDate
},

subtitle: {
    text: 'Source: <a href="https://polygon.io/"> Polygon.io</a>'
},


xAxis: {
    type: 'datetime',
    dateTimeLabelFormats: {
      millisecond: '%H:%M:%S.%L ',
      second: '%H:%M:%S',
      minute: '%H:%M',
      hour: '%H:%M',
      day: '%e. %b',
      week: '%e. %b',
      month: '%b \'%y',
      year: '%Y'
    },
},

rangeSelector: {
    buttons: [{
        type: 'day',
        count: 7,
        text: '7d'
    }, {
        type: 'day',
        count: 15,
        text: '15d'
    }, {
        type: 'month',
        count: 1,
        text: '1m'
    },

    {
        type: 'month',
        count: 3,
        text: '3m'
    },
    {
        type: 'month',
        count: 6,
        text: '6m'
    }],
    selected: 1,
    inputEnabled: false
},
yAxis: [{
    title: {
      text: 'Stock Price'
    },
    opposite:false,
  }
  ,{
    title: {
      text: 'Volumn'
    },
    labels: {
        formatter: function () {
            return this.value +'M';
        }
    }
}
],
series: [{
    name: info.ticker,
    type: 'area',
    data: DataArray1,
    gapSize: 5,
    tooltip: {
        valueDecimals: 2
    },
    fillColor: {
        linearGradient: {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: 1
        },
        stops: [
            [0, Highcharts.getOptions().colors[0]],
            [1, Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
        ]
    },
    threshold: null
}
,{
    name: 'Volumn',
    type: 'column',
    data: DataArray2,
    yAxis:1,
    color:"#808080",
    tooltip: {
        valueDecimals: 0
    },
    // gapSize: 5,
    // tooltip: {
    //     valueDecimals: 2
    // },
    // fillColor: {
    //     linearGradient: {
    //         x1: 0,
    //         y1: 0,
    //         x2: 0,
    //         y2: 1
    //     },
    //     stops: [
    //         [0, Highcharts.getOptions().colors[0]],
    //         [1, Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
    //     ]
    // },
    // threshold: null
}
],

});


            // news
            for(let i = 1;i<= 5;i++){
                imgID = "newsImg" + i.toString()
                headingID = "news" + i.toString() +"h"
                pID = "news" + i.toString() + "p"
                aID = "news" + i.toString() + "a"
                if(i == 1){
                    document.getElementById(imgID).src = info.image1
                    document.getElementById(headingID).innerHTML = info.headline1
                    document.getElementById(pID).innerHTML = info.datetime1
                    document.getElementById(aID).innerHTML = "See Original Post"
                    document.getElementById(aID).setAttribute('href',info.url1)
                }
                else if(i == 2){
                    document.getElementById(imgID).src = info.image2
                    document.getElementById(headingID).innerHTML = info.headline2
                    document.getElementById(pID).innerHTML = info.datetime2
                    document.getElementById(aID).innerHTML = "See Original Post"
                    document.getElementById(aID).setAttribute('href',info.url2)
                }

                else if(i == 3){
                    document.getElementById(imgID).src = info.image3
                    document.getElementById(headingID).innerHTML = info.headline3
                    document.getElementById(pID).innerHTML = info.datetime3
                    document.getElementById(aID).innerHTML = "See Original Post"
                    document.getElementById(aID).setAttribute('href',info.url3)
                }

                else if( i== 4){
                    document.getElementById(imgID).src = info.image4
                    document.getElementById(headingID).innerHTML = info.headline4
                    document.getElementById(pID).innerHTML = info.datetime4
                    document.getElementById(aID).innerHTML = "See Original Post"
                    document.getElementById(aID).setAttribute('href',info.url4)
                }

                else{
                    document.getElementById(imgID).src = info.image5
                    document.getElementById(headingID).innerHTML = info.headline5
                    document.getElementById(pID).innerHTML = info.datetime5
                    document.getElementById(aID).innerHTML = "See Original Post"
                    document.getElementById(aID).setAttribute('href',info.url5)
                }
            }
        }

    </script>

    
</body>
</html>